---
import { getCollection } from "astro:content";
import MainGridLayout from "../../layouts/MainGridLayout.astro";
import Markdown from "../../components/misc/Markdown.astro";

export async function getStaticPaths() {
  const blogPosts = await getCollection("blogs");
  return blogPosts.map(post => ({
    params: { slug: post.slug },
    props: { post },
  }));
}

const { post } = Astro.props;
const { Content } = await post.render();
const { title, description, published, updated, image, tags, category } = post.data;

// Calculate reading time
const readingTime = (content) => {
  const wordsPerMinute = 200;
  const wordCount = content.split(/\s+/).length;
  return Math.ceil(wordCount / wordsPerMinute);
};

const readingMinutes = readingTime(post.body);
---

<MainGridLayout title={title} description={description || ""} headings={[]}>
  <div class="card-base pt-2">
    <div class="pt-6 md:px-8">
      <header class="mb-0">
        <div class="flex flex-wrap gap-2  mb-0">
          {category && (
            <span class="px-3 py-1 text-sm font-medium rounded-full bg-[var(--primary)]/10 text-black dark:text-white">
              {category}
            </span>
          )}
          {tags && tags.map(tag => (
            <span class="px-3 py-1 text-sm font-medium rounded-full bg-gray-100 dark:bg-gray-800 text-black dark:text-white">
              {tag}
            </span>
          ))}
        </div>
        
        <h1 class="text-3xl md:text-4xl font-bold mb-4 pt-4 text-black dark:text-white">{title}</h1>
        
        <div class="flex flex-wrap items-center gap-4 text-sm text-gray-500 dark:text-gray-400">
          <span>{readingMinutes} min read</span>
          <span>â€¢</span>
          <time datetime={published.toISOString()}>
            {published.toLocaleDateString("en-US", { 
              year: 'numeric', 
              month: 'long', 
              day: 'numeric' 
            })}
          </time>
        </div>
      </header>
    </div>

    {image && (
      <div class="w-full">
        <img
          src={image}
          alt={title}
          class="w-full h-auto max-h-[500px] object-cover"
        />
      </div>
    )}

    <div class="p-6 md:p-8 ">
      <div class="prose dark:prose-invert   markdown-content">
        <Content 
        
        />
      </div>
    </div>
  </div>
</MainGridLayout>

<style>
  .markdown-content {
    @apply space-y-6;
  }
  .markdown-content h2 {
    @apply text-2xl font-bold mt-8 mb-4;
  }
  .markdown-content h3 {
    @apply text-xl font-semibold mt-6 mb-3;
  }
  .markdown-content p {
    @apply my-4 leading-relaxed;
  }
  .markdown-content ul, 
  .markdown-content ol {
    @apply my-4 pl-6;
  }
  .markdown-content li {
    @apply mb-2;
  }
  .markdown-content a {
    @apply text-[var(--primary)] hover:underline;
  }
  .markdown-content code {
    @apply bg-gray-100 dark:bg-gray-800 rounded px-2 py-1 text-sm;
  }
  .markdown-content pre {
    @apply bg-gray-100 dark:bg-gray-800 rounded-lg p-4 my-4 overflow-x-auto;
  }
  .markdown-content pre code {
    @apply bg-transparent p-0;
  }
  .markdown-content blockquote {
    @apply border-l-4 border-[var(--primary)] pl-4 py-1 my-4 text-gray-600 dark:text-gray-300;
  }
</style>
 

 <script is:inline>
  document.addEventListener('DOMContentLoaded', () => {
    // Add IDs to all h2 and h3 elements
    const headings = document.querySelectorAll('h2, h3');
    
    headings.forEach(heading => {
      // Create ID from heading text
      const id = heading.textContent
        .toLowerCase()
        .replace(/[^\w\s-]/g, '') // Remove special chars
        .replace(/\s+/g, '-')     // Replace spaces with -
        .replace(/-+/g, '-');     // Replace multiple - with single -
      
      heading.id = id;
      
      // Create and append the anchor link
      const anchor = document.createElement('a');
      anchor.href = `#${id}`;
      anchor.className = 'anchor-link';
      anchor.textContent = '#';
      anchor.style.marginLeft = '-1.5rem';
      anchor.style.paddingRight = '0.5rem';
      anchor.style.textDecoration = 'none';
      anchor.style.opacity = '0';
      anchor.style.transition = 'opacity 0.2s ease';
      anchor.style.color = 'var(--primary)';
      
      // Show on hover
      heading.style.position = 'relative';
      heading.addEventListener('mouseenter', () => {
        anchor.style.opacity = '1';
      });
      heading.addEventListener('mouseleave', () => {
        anchor.style.opacity = '0';
      });
      
      // Insert anchor before the heading text
      if (heading.firstChild) {
        heading.insertBefore(anchor, heading.firstChild);
      } else {
        heading.appendChild(anchor);
      }
    });
  });
</script>

<style>
  .markdown-content h2,
  .markdown-content h3 {
    position: relative;
  }
  
  .markdown-content h2 .anchor-link,
  .markdown-content h3 .anchor-link {
    position: absolute;
    left: -1.5rem;
    text-decoration: none;
    opacity: 0;
    transition: opacity 0.2s ease;
    color: var(--primary);
  }
  
  .markdown-content h2:hover .anchor-link,
  .markdown-content h3:hover .anchor-link {
    opacity: 1;
  }
</style>